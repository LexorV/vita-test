import{C as w,r as y,t as _,n as N,o as Q,x as V,z as s,A as i,L as S,P as c,G as B,M as v,Q as P,R,K as q,y as U,S as f}from"./index-DlmhaCa1.js";import{h as D,g as k,i as C,j as m,k as E,l as F,f as z,_ as M}from"./CommentForm.vue_vue_type_style_index_0_scoped_fe3fdbb5_lang-OKrdhW-x.js";import{api as I}from"./axios-CBiA5BwK.js";import{u as T}from"./post-store-BkoIMGwp.js";async function A(n,r){const{data:u}=await I.post("/post",n,{params:{userInfoId:r}});return u}async function L(n){const{data:r}=await I.put("/post",n);return r}const j={class:"text-h6"},G=w({__name:"PostForm",props:{isEdit:{type:Boolean,default:!1},initialId:{},initialTitle:{default:""},initialBriefDescription:{default:""},initialFullDescription:{default:""}},setup(n){const r=n,u=y(null),o=y(!1),d=T(),b=q(),t=_({userInfoId:null,title:r.initialTitle,briefDescription:r.initialBriefDescription,fullDescription:r.initialFullDescription}),p={required:e=>e&&e.toString().trim().length>0||"Обязательное поле",max50:e=>!e||e.length<=50||"Максимум 50 символов",max100:e=>!e||e.length<=100||"Максимум 100 символов",max255:e=>!e||e.length<=255||"Максимум 255 символов",userRequired:e=>e!==null&&!Number.isNaN(e)||"Выберите пользователя"};N(()=>{t.userInfoId=d.targetUserId}),Q(()=>{d.clearTargetUser()});async function h(){if(!u.value)return;const e=u.value.validate();if(typeof e=="boolean"?e:await e){if(!r.isEdit&&(t.userInfoId===null||Number.isNaN(Number(t.userInfoId)))){f.create({type:"negative",message:"Не выбран пользователь"});return}o.value=!0;try{if(r.isEdit){const a={id:Number(r.initialId),title:t.title.trim(),briefDescription:t.briefDescription.trim(),fullDescription:t.fullDescription?.trim()||""};await L(a),f.create({type:"positive",message:"Запись обновлена"}),d.invalidatePosts(),g()}else{const a={title:t.title.trim(),briefDescription:t.briefDescription.trim(),fullDescription:t.fullDescription?.trim()||""};await A(a,Number(t.userInfoId)),f.create({type:"positive",message:"Запись создана"}),d.invalidatePosts(),g()}}catch(a){console.error(a),f.create({type:"negative",message:"Ошибка запроса"})}finally{o.value=!1}}}function x(){t.userInfoId=d.targetUserId,t.title="",t.briefDescription="",t.fullDescription=""}function g(){typeof window<"u"&&window.history.length>1?b.back():b.push("/")}return(e,l)=>(U(),V(z,{class:"form-card",bordered:""},{default:s(()=>[i(D,{class:"row items-center q-gutter-sm"},{default:s(()=>[i(c,{name:"article",color:"primary",size:"28px"}),S("div",j,B(e.isEdit?"Редактирование поста":"Создание поста"),1)]),_:1}),i(k,{spaced:""}),i(D,null,{default:s(()=>[i(C,{onSubmit:v(h,["prevent"]),onReset:v(x,["prevent"]),ref_key:"formRef",ref:u,class:"q-gutter-md"},{default:s(()=>[i(m,{modelValue:t.title,"onUpdate:modelValue":l[0]||(l[0]=a=>t.title=a),label:"Заголовок",rules:[p.required,p.max50],outlined:"",clearable:"",disable:o.value,maxlength:"50",hint:"До 50 символов"},{prepend:s(()=>[i(c,{name:"title"})]),_:1},8,["modelValue","rules","disable"]),i(m,{modelValue:t.briefDescription,"onUpdate:modelValue":l[1]||(l[1]=a=>t.briefDescription=a),label:"Краткое описание",rules:[p.required,p.max100],type:"textarea",autogrow:"",outlined:"",clearable:"",disable:o.value,maxlength:"100",hint:"Краткий текст, до 100 символов"},{prepend:s(()=>[i(c,{name:"short_text"})]),_:1},8,["modelValue","rules","disable"]),i(m,{modelValue:t.fullDescription,"onUpdate:modelValue":l[2]||(l[2]=a=>t.fullDescription=a),label:"Полное описание",rules:[p.max255],type:"textarea",autogrow:"",outlined:"",clearable:"",disable:o.value,maxlength:"255",hint:"Раскройте подробности, до 255 символов"},{prepend:s(()=>[i(c,{name:"description"})]),_:1},8,["modelValue","rules","disable"]),i(E,{align:"right",class:"q-pa-none"},{default:s(()=>[i(P,{label:e.isEdit?"Сохранить":"Создать",type:"submit",color:"primary",loading:o.value,icon:"save",unelevated:""},null,8,["label","loading"])]),_:1})]),_:1},512)]),_:1}),i(F,{showing:o.value},{default:s(()=>[i(R,{size:"42px",color:"primary"})]),_:1},8,["showing"])]),_:1}))}}),W=M(G,[["__scopeId","data-v-3209e174"]]);export{W as P};
